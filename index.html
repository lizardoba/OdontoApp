<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OdontoApp â€” DentiStudio</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦·</text></svg>">
</head>
<body>
  <div class="app">
    <!-- ğŸ§­ Header Global -->
    <header class="app-header">
      <div class="header-logo">
        <span class="header-icon">ğŸ¦·</span>
        <h1>OdontoApp</h1>
        <p>DentiStudio | Ayacucho, Huamanga</p>
      </div>
      <nav class="app-tabs">
        <button class="tab-btn active" data-tab="gestor">ğŸ‘¥ Pacientes</button>
        <button class="tab-btn" data-tab="moyers">ğŸ“ Moyers & T&J</button>
        <button class="tab-btn" data-tab="discrepancia">ğŸ¦· Discrepancia + Bolton</button>
        <button class="tab-btn" data-tab="catalogo">ğŸ’° Servicios</button>
        <button class="btn-primary" onclick="nuevaCita()">ğŸ“… Nueva Cita</button>
      </nav>
    </header>

    <!-- ğŸ“„ Contenido Principal -->
    <main class="app-content">
      <!-- âœ… MÃ³dulo 1: Gestor de Pacientes -->
      <section id="gestor" class="tab-content active">
        <div class="container">
          <div class="header-section">
            <h1>ğŸ¥ Gestor de Pacientes â€” DentiStudio</h1>
            <p>Sistema clÃ­nico con historial, bÃºsqueda y exportaciÃ³n</p>
          </div>

          <div class="alert alert-info" id="alertConfig" style="display: none;">
            <strong>âš™ï¸ ConfiguraciÃ³n:</strong> Token de GitHub no guardado.
            <button onclick="mostrarConfig()" class="btn-link">Configurar</button>
          </div>

          <section class="github-config" id="githubConfig" style="display: none;">
            <h3>ğŸ” ConfiguraciÃ³n de GitHub (opcional)</h3>
            <div class="form-group">
              <label>Token Personal (PAT):</label>
              <input type="password" id="githubToken" placeholder="ghp_..." />
            </div>
            <div class="form-group">
              <label>Usuario:</label>
              <input type="text" id="githubUser" placeholder="tu-usuario" />
            </div>
            <div class="form-group">
              <label>Repositorio:</label>
              <input type="text" id="githubRepo" value="odontoapp-dentistudio" />
            </div>
            <div class="btn-group">
              <button onclick="guardarConfigGitHub()" class="btn btn-primary">âœ… Guardar</button>
              <button onclick="ocultarConfig()" class="btn btn-secondary">âŒ Cancelar</button>
            </div>
          </section>

          <div class="two-columns">
            <!-- ğŸ” BÃºsqueda -->
            <section class="search-section">
              <h2>ğŸ” BÃºsqueda de Pacientes</h2>
              <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="CÃ³digo, nombre o apellido..." />
                <select id="tipoSearch" class="search-select">
                  <option value="todos">Todos</option>
                  <option value="codigo">CÃ³digo</option>
                  <option value="nombre">Nombre</option>
                  <option value="apellido">Apellido</option>
                </select>
              </div>
              <div id="resultadosBusqueda" class="search-results"></div>
            </section>

            <!-- â• Formulario -->
            <section class="form-section">
              <h2>â• Nuevo Paciente</h2>
              <form id="formPaciente" class="form-paciente">
                <div class="form-group">
                  <label>CÃ³digo:</label>
                  <input type="text" id="codigo" placeholder="P-001" required />
                </div>
                <div class="form-group">
                  <label>Nombre:</label>
                  <input type="text" id="nombre" placeholder="Juan" required />
                </div>
                <div class="form-group">
                  <label>Apellido:</label>
                  <input type="text" id="apellido" placeholder="PÃ©rez" required />
                </div>
                <div class="form-group">
                  <label>Email:</label>
                  <input type="email" id="email" placeholder="correo@ejemplo.com" />
                </div>
                <div class="form-group">
                  <label>TelÃ©fono:</label>
                  <input type="tel" id="telefono" placeholder="+51 9 XXXX XXXX" />
                </div>
                <div class="form-group">
                  <label>Edad:</label>
                  <input type="number" id="edad" min="0" max="120" placeholder="Ej: 12" />
                </div>
                <div class="form-group">
                  <label>DiagnÃ³stico:</label>
                  <textarea id="diagnostico" placeholder="ApiÃ±amiento moderado, clase I"></textarea>
                </div>
                <div class="form-group">
                  <label>Tratamiento:</label>
                  <select id="tratamiento">
                    <option>Ortodoncia Fija</option>
                    <option>Ortodoncia Removible</option>
                    <option>Profilaxis</option>
                    <option>Blanqueamiento</option>
                    <option>Otro</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Estado:</label>
                  <select id="estado">
                    <option>Activo</option>
                    <option>Inactivo</option>
                    <option>Completado</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary">ğŸ’¾ Guardar Paciente</button>
              </form>
            </section>
          </div>

          <!-- ğŸ“Š EstadÃ­sticas -->
          <section class="stats-section">
            <h2>ğŸ“Š EstadÃ­sticas ClÃ­nicas</h2>
            <div class="stats-container">
              <div class="stat-card">
                <h3 id="totalPacientes">0</h3>
                <p>Pacientes Totales</p>
              </div>
              <div class="stat-card">
                <h3 id="pacientesActivos">0</h3>
                <p>Activos</p>
              </div>
              <div class="stat-card">
                <h3 id="promedioEdad">â€”</h3>
                <p>Edad Promedio</p>
              </div>
            </div>
            <div class="buttons-export">
              <button onclick="exportarJSON()" class="btn btn-secondary">ğŸ“¥ Exportar JSON</button>
              <button onclick="importarJSON()" class="btn btn-secondary">ğŸ“¤ Importar JSON</button>
              <button onclick="enviarWhatsApp()" class="btn btn-whatsapp">ğŸ“± WhatsApp</button>
            </div>
          </section>

          <!-- ğŸ‘¥ Lista -->
          <section class="patients-section">
            <h2>ğŸ“‹ Lista de Pacientes</h2>
            <div id="listaPacientes" class="patients-list">
              <p class="empty-message">No hay pacientes registrados</p>
            </div>
          </section>
        </div>
        <input type="file" id="fileInput" style="display: none;" accept=".json" />
      </section>

      <!-- ğŸ“ MÃ³dulo 2: Moyers & Tanaka-Johnston -->
      <section id="moyers" class="tab-content">
        <div class="analysis-container">
          <div class="header-analysis">
            <h1>ğŸ“ AnÃ¡lisis Moyers & Tanaka-Johnston â€” DentiStudio</h1>
            <p>PredicciÃ³n de espacio en denticiÃ³n mixta (niÃ±os/adolescentes)</p>
          </div>
          <div class="content-analysis">
            <div class="card">
              <h2>ğŸ“Š Datos del Paciente y Modelo</h2>
              <div class="form-group">
                <label>Nombre del Paciente:</label>
                <input type="text" id="moyers-patient" placeholder="Ej: Carlos Mendoza" />
              </div>
              <div class="form-group">
                <label>Suma de incisivos inferiores (31+32+41+42) en mm:</label>
                <input type="number" id="inci_mm" step="0.1" placeholder="Ej: 24.5" min="20" max="30" />
              </div>
              <div class="form-group">
                <label>Sexo:</label>
                <select id="sexo">
                  <option value="varon">VarÃ³n</option>
                  <option value="mujer">Mujer</option>
                </select>
              </div>
              <div class="form-group">
                <label>Arcada a analizar:</label>
                <select id="arcada">
                  <option>Superior</option>
                  <option>Inferior</option>
                </select>
              </div>
              <div class="form-group">
                <label>Espacio disponible en modelo (mm):</label>
                <input type="number" id="espacio_modelo" step="0.1" placeholder="Ej: 17.8" />
              </div>
              <button onclick="calcularMoyers()" class="btn btn-primary">ğŸ” Calcular AnÃ¡lisis</button>
              <div id="resultadosMoyers"></div>
              <div id="diagnosticoIntegrado" class="recommendation" style="display: none;"></div>
            </div>

            <div class="card">
              <h2>ğŸ“˜ GuÃ­a ClÃ­nica</h2>
              <div class="instructions">
                <p><strong>1.</strong> Mida los 4 incisivos inferiores permanentes (31,32,41,42).</p>
                <p><strong>2.</strong> Sume sus anchos mesiodistales (mm).</p>
                <p><strong>3.</strong> Mida el espacio disponible desde la alineaciÃ³n de incisivos hasta el molar permanente.</p>
                <p><strong>4.</strong> Use el percentil 75% para tratamiento preventivo.</p>
                <hr />
                <p><strong style="color: var(--color-success);">âœ… Positivo:</strong> Espacio suficiente</p>
                <p><strong style="color: var(--color-error);">âš ï¸ Negativo:</strong> ApiÃ±amiento probable</p>
              </div>
            </div>

            <div class="table-section">
              <h2>ğŸ“Š Tabla Moyers â€” Percentil 75% y 90%</h2>
              <table>
                <thead>
                  <tr>
                    <th rowspan="2">Suma Inc. Inf.</th>
                    <th colspan="2">Percentil 75%</th>
                    <th colspan="2">Percentil 90%</th>
                  </tr>
                  <tr>
                    <th>Sup</th><th>Inf</th><th>Sup</th><th>Inf</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>22.0</td><td>19.2</td><td>18.7</td><td>20.1</td><td>19.5</td></tr>
                  <tr><td>23.0</td><td>20.6</td><td>19.8</td><td>21.8</td><td>20.9</td></tr>
                  <tr><td>24.0</td><td>21.8</td><td>20.9</td><td>23.2</td><td>22.1</td></tr>
                  <tr><td>24.5</td><td>22.8</td><td>22.5</td><td>24.5</td><td>24.0</td></tr>
                  <tr><td>25.0</td><td>23.3</td><td>23.0</td><td>25.2</td><td>25.0</td></tr>
                  <tr><td>25.5</td><td>24.6</td><td>24.2</td><td>26.8</td><td>26.5</td></tr>
                  <tr><td>26.0</td><td>25.4</td><td>25.0</td><td>27.9</td><td>27.5</td></tr>
                </tbody>
              </table>
            </div>

            <div class="card">
              <h2>ğŸ“ˆ GrÃ¡fico Comparativo</h2>
              <div id="graficoMoyers" style="height: 200px; background: var(--color-surface); border-radius: var(--radius-base); margin-top: var(--space-16); display: flex; align-items: center; justify-content: center;">
                <p style="color: var(--color-text-secondary);">Ingrese datos para ver el grÃ¡fico</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ¦· MÃ³dulo 3: Discrepancia + Bolton (Permanente + Mixta) -->
      <section id="discrepancia" class="tab-content">
        <div class="app-container">
          <div class="header-app">
            <h1>ğŸ¦· Discrepancia Dentaria & Bolton â€” DentiStudio</h1>
            <p>CÃ¡lculos clÃ­nicos para denticiÃ³n permanente y mixta</p>
          </div>

          <!-- Tabs DenticiÃ³n -->
          <div class="dentition-tabs">
            <button class="tab-button active" data-tab-type="permanent">DenticiÃ³n Permanente</button>
            <button class="tab-button" data-tab-type="mixed">DenticiÃ³n Mixta</button>
          </div>

          <!-- DenticiÃ³n Permanente -->
          <div id="permanent-tab" class="dentition-content active">
            <div class="content-grid">
              <div class="card">
                <h3>ğŸ§‘â€âš•ï¸ Datos del Paciente</h3>
                <div class="form-group">
                  <label>Nombre:</label>
                  <input type="text" class="form-input" id="perm-patient" placeholder="Nombre del paciente">
                </div>

                <h3 style="margin-top: var(--space-24);">ğŸ“ Anchos Mesiodistales (mm)</h3>
                <div class="teeth-two-columns">
                  <div class="teeth-column">
                    <h4 class="column-title">ARCADA SUPERIOR</h4>
                    <!-- 10 inputs (16â†’26) -->
                    <div class="tooth-input-group"><label>2Âª Premolar Der</label><input type="number" class="form-input" id="perm-sup-1" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>1Âª Premolar Der</label><input type="number" class="form-input" id="perm-sup-2" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Canino Der</label><input type="number" class="form-input" id="perm-sup-3" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Lat. Der</label><input type="number" class="form-input" id="perm-sup-4" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Cent. Der</label><input type="number" class="form-input" id="perm-sup-5" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Cent. Izq</label><input type="number" class="form-input" id="perm-sup-6" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Lat. Izq</label><input type="number" class="form-input" id="perm-sup-7" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Canino Izq</label><input type="number" class="form-input" id="perm-sup-8" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>1Âª Premolar Izq</label><input type="number" class="form-input" id="perm-sup-9" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>2Âª Premolar Izq</label><input type="number" class="form-input" id="perm-sup-10" step="0.1" oninput="calculatePermanent()"></div>
                  </div>
                  <div class="teeth-column">
                    <h4 class="column-title">ARCADA INFERIOR</h4>
                    <!-- 10 inputs (36â†’46) -->
                    <div class="tooth-input-group"><label>2Âª Premolar Der</label><input type="number" class="form-input" id="perm-inf-1" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>1Âª Premolar Der</label><input type="number" class="form-input" id="perm-inf-2" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Canino Der</label><input type="number" class="form-input" id="perm-inf-3" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Lat. Der</label><input type="number" class="form-input" id="perm-inf-4" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Cent. Der</label><input type="number" class="form-input" id="perm-inf-5" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Cent. Izq</label><input type="number" class="form-input" id="perm-inf-6" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Inc. Lat. Izq</label><input type="number" class="form-input" id="perm-inf-7" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>Canino Izq</label><input type="number" class="form-input" id="perm-inf-8" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>1Âª Premolar Izq</label><input type="number" class="form-input" id="perm-inf-9" step="0.1" oninput="calculatePermanent()"></div>
                    <div class="tooth-input-group"><label>2Âª Premolar Izq</label><input type="number" class="form-input" id="perm-inf-10" step="0.1" oninput="calculatePermanent()"></div>
                  </div>
                </div>

                <div class="form-group">
                  <label>Espacio Disponible (mm)</label>
                  <div class="space-inputs">
                    <div><label>Superior</label><input type="number" class="form-input" id="perm-espacio-sup" step="0.1" oninput="calculatePermanent()"></div>
                    <div><label>Inferior</label><input type="number" class="form-input" id="perm-espacio-inf" step="0.1" oninput="calculatePermanent()"></div>
                  </div>
                </div>

                <div class="bolton-section">
                  <h3>âš–ï¸ AnÃ¡lisis de Bolton (Auto-cÃ¡lculo)</h3>
                  <div class="form-group">
                    <label>6 Dientes Anteriores (suma automÃ¡tica)</label>
                    <div class="bolton-inputs">
                      <div><label>Superior</label><input type="number" class="form-input" id="bolton-ant-sup" readonly></div>
                      <div><label>Inferior</label><input type="number" class="form-input" id="bolton-ant-inf" readonly></div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label>1Âªs Molares (mm)</label>
                    <div class="bolton-inputs">
                      <div><input type="number" class="form-input" id="bolton-mol-sup-der" step="0.1" placeholder="10.5" oninput="calculatePermanent()"></div>
                      <div><input type="number" class="form-input" id="bolton-mol-sup-izq" step="0.1" placeholder="10.5" oninput="calculatePermanent()"></div>
                      <div><input type="number" class="form-input" id="bolton-mol-inf-der" step="0.1" placeholder="11.0" oninput="calculatePermanent()"></div>
                      <div><input type="number" class="form-input" id="bolton-mol-inf-izq" step="0.1" placeholder="11.0" oninput="calculatePermanent()"></div>
                    </div>
                  </div>
                </div>

                <div class="button-group">
                  <button class="btn btn-secondary" onclick="clearAllData()">ğŸ—‘ï¸ Limpiar Todo</button>
                  <button class="btn btn-secondary" onclick="loadPermanentExample()">ğŸ§ª Ejemplo</button>
                </div>
              </div>

              <div class="card">
                <h3>ğŸ“Š Resultados</h3>
                <div class="result-item">
                  <div class="result-label">Esp. Req. Superior</div>
                  <div class="result-value" id="perm-required-sup">â€” mm</div>
                </div>
                <div class="result-item">
                  <div class="result-label">Discrepancia Sup.</div>
                  <div class="result-value" id="perm-discrepancy-sup">â€” mm</div>
                  <div class="discrepancy-bar"><div class="discrepancy-fill" id="perm-bar-sup"></div></div>
                </div>
                <div class="result-item">
                  <div class="result-label">Esp. Req. Inferior</div>
                  <div class="result-value" id="perm-required-inf">â€” mm</div>
                </div>
                <div class="result-item">
                  <div class="result-label">Discrepancia Inf.</div>
                  <div class="result-value" id="perm-discrepancy-inf">â€” mm</div>
                  <div class="discrepancy-bar"><div class="discrepancy-fill" id="perm-bar-inf"></div></div>
                </div>
                <div class="recommendation">
                  <div class="recommendation-title">ğŸ©º RecomendaciÃ³n ClÃ­nica</div>
                  <div class="recommendation-text" id="perm-recommendation">Ingrese datos para diagnÃ³stico</div>
                </div>
                <div id="bolton-results"></div>
                <div class="button-group">
                  <button class="btn btn-primary" onclick="saveResultsLocal()">ğŸ’¾ Guardar Local</button>
                  <button class="btn btn-secondary" onclick="generatePDFReport()">ğŸ“„ Generar PDF</button>
                </div>
              </div>
            </div>
          </div>

          <!-- DenticiÃ³n Mixta (nuevo) -->
          <div id="mixed-tab" class="dentition-content">
            <div class="content-grid">
              <div class="card">
                <h3>ğŸ§’ Datos del Paciente</h3>
                <div class="form-group">
                  <label>Nombre:</label>
                  <input type="text" class="form-input" id="mix-patient" placeholder="Nombre del paciente">
                </div>
                <h3 style="margin-top: var(--space-24);">ğŸ“ Dientes Permanentes en Arcada Superior</h3>
                <div class="form-group">
                  <label>Incisivos Centrales y Laterales + Caninos (mm)</label>
                  <input type="number" class="form-input" id="mix-sup-anteriores" step="0.1" placeholder="Ej: 35.0" oninput="calculateMixed()">
                </div>
                <div class="form-group">
                  <label>Espacio Disponible Sup. (mm)</label>
                  <input type="number" class="form-input" id="mix-espacio-sup" step="0.1" placeholder="Ej: 38.0" oninput="calculateMixed()">
                </div>
                <h3 style="margin-top: var(--space-24);">ğŸ“ Dientes Permanentes en Arcada Inferior</h3>
                <div class="form-group">
                  <label>Incisivos Centrales y Laterales + Caninos (mm)</label>
                  <input type="number" class="form-input" id="mix-inf-anteriores" step="0.1" placeholder="Ej: 32.5" oninput="calculateMixed()">
                </div>
                <div class="form-group">
                  <label>Espacio Disponible Inf. (mm)</label>
                  <input type="number" class="form-input" id="mix-espacio-inf" step="0.1" placeholder="Ej: 34.0" oninput="calculateMixed()">
                </div>
                <button class="btn btn-secondary" onclick="loadMixedExample()">ğŸ§ª Ejemplo Mixto</button>
              </div>
              <div class="card">
                <h3>ğŸ“Š Resultados Mixtos</h3>
                <div class="result-item">
                  <div class="result-label">Discrepancia Superior</div>
                  <div class="result-value" id="mix-disc-sup">â€” mm</div>
                </div>
                <div class="result-item">
                  <div class="result-label">Discrepancia Inferior</div>
                  <div class="result-value" id="mix-disc-inf">â€” mm</div>
                </div>
                <div class="recommendation">
                  <div class="recommendation-title">ğŸ©º RecomendaciÃ³n Interceptar</div>
                  <div class="recommendation-text" id="mix-recommendation">Ingrese datos para diagnÃ³stico</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ’° MÃ³dulo 4: CatÃ¡logo Gniius -->
      <section id="catalogo" class="tab-content">
        <div class="catalog-header">
          <h1>ğŸŒŸ Gniius â€” DentiStudio</h1>
          <p>Centro Integral Infantil y Familiar Â· Ayacucho</p>
          <button class="btn-edit" onclick="mostrarEdicionPrecios()">âš™ï¸ Editar Precios</button>
        </div>
        <div class="services-grid" id="servicesGrid"></div>

        <!-- âœï¸ EdiciÃ³n de Precios -->
        <div class="price-management" id="priceManagement">
          <div class="price-header">
            <h2>âœï¸ Administrar Precios e ImÃ¡genes</h2>
            <div class="btn-group">
              <button class="btn btn-secondary" onclick="cancelarEdicionPrecios()">âŒ Cancelar</button>
              <button class="btn btn-primary" onclick="guardarCambiosPrecios()">âœ… Guardar Cambios</button>
            </div>
          </div>
          <div class="price-list" id="priceList"></div>
        </div>
      </section>
    </main>

    <!-- ğŸ–¼ï¸ Modal de Servicio -->
    <div class="modal" id="modal">
      <div class="modal__content">
        <button class="modal__close" id="modalClose">&times;</button>
        <img class="modal__image" id="modalImage" alt="">
        <div class="modal__body">
          <h2 id="modalTitle"></h2>
          <div id="modalPrice"></div>
          <p id="modalDescription"></p>
          <button class="btn btn-primary" onclick="agendarDesdeModal()">ğŸ“… Agendar Cita</button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </div>
</body>
</html>
